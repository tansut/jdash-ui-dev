<style>
    .stockquery-container {
        max-height: 400px;
        overflow-y: auto;
    }
    
    .stock-template {
        font-size: 10px;
        margin: 0 2.5vw;
    }
    
    .stock-name,
    .price-change {
        font-size: 32px;
        font-family: 'Poppins';
        font-weight: 900;
    }
    
    .stock-price,
    .price-percent {
        font-size: 32px;
        color: #bbb;
        font-family: 'Lato';
        font-weight: 400;
        padding-bottom: 1.5rem;
    }
    
    .stock-title {
        color: dodgerblue;
    }
    
    .time,
    .yearly-high,
    .yearly-low {
        color: #bbb;
        font-weight: 400;
    }
    
    .vp-market-quotes {
        width: 100%;
        position: relative;
        padding: 1.5rem 0;
        box-sizing: border-box;
        max-width: 800px;
    }
    
    .vp-market-quotes>div {
        border: 1px solid #f4f4f4;
        float: left;
        margin: 0 1.65%;
        width: 30%;
        box-shadow: 0 1px 2px rgba(0, 0, 0, .1);
        border-radius: 2px;
        padding: 20px 2vw;
        box-sizing: inherit;
        position: relative;
        overflow: hidden;
    }
    
    .vp-market-quotes>div>table {
        width: 100%;
    }
    
    .vp-neg {
        color: #cd4f55;
    }
    
    .vp-pos {
        color: #4fcd88;
    }
    
    .vp-ntrl {
        color: #999;
    }
    
    .vp-market-quotes>div {
        width: 80%;
        margin: 15px 10%;
        padding: 20px 5vw;
    }
</style>

<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,900|Poppins:400,600,700,900" rel="stylesheet">

<j-dashlet id="j-stockquery" title="Stock Quotes">
    <template>
        <div class="stockquery-container">
        </div>

        <template id="stock-template">
            <section class="vp-market-quotes">
                <div>
                    <table>
                        <tr>
                            <td class="stock-name">Dow Jones</td>
                            <td class="price-change">-19.93</td>
                        </tr>
                        <tr>
                            <td class="stock-price">20,914.62</td>
                            <td class="price-percent">(-0.10%)</td>
                        </tr>
                        <tr>
                            <td class="stock-title">Yearly High</td>
                            <td class="yearly-high"></td>
                        </tr>
                        <tr>
                            <td class="stock-title">Yearly Low</td>
                            <td class="yearly-low"></td>
                        </tr>
                        <tr>
                            <td class="stock-title">Valid Time</td>
                            <td class="time"></td>
                        </tr>
                    </table>
                </div>

            </section>
        </template>

    </template>

    </template>
    <script>
        jdash.define(function () {

            this.initialized = function () {
                var yahoo = "https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20in%20(%22YHOO%22)&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys";
                var google = "https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20in%20(%22GOOG%22)&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys";
                var amazon = "https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20in%20(%22AMZN%22)&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys";
                var twitter = "https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20in%20(%22TWTR%22)&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys";
                var facebook = "https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20in%20(%22FB%22)&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys";
                var apple = "https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20in%20(%22AAPL%22)&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys";
                var jp = "https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20in%20(%22JPM%22)&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys";
                var goldman = "https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20in%20(%22GS%22)&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys";
                var boa = "https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20in%20(%22BAC%22)&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys";

                var self = this;

                var quotes = [yahoo, google, amazon, twitter, facebook, apple, jp, goldman, boa];
                function getQuotes() {
                    self.querySelector('.stockquery-container').innerHTML = '';

                    quotes.forEach(function (quote) {
                        jdash.Http.get(quote).then(function (res) {
                            var data = res.data;
                            var stockTemp = self.querySelector('#stock-template');
                            var cloned = document.importNode(stockTemp.content, true);

                            cloned.querySelector(".stock-name").innerText = data.query.results.quote.symbol;
                            cloned.querySelector(".stock-price").innerText = data.query.results.quote.LastTradePriceOnly;
                            cloned.querySelector(".price-change").innerText = data.query.results.quote.Change;
                            cloned.querySelector(".price-percent").innerText = '(' + data.query.results.quote.ChangeinPercent + ')';
                            cloned.querySelector(".yearly-high").innerText = data.query.results.quote.YearHigh;
                            cloned.querySelector(".yearly-low").innerText = data.query.results.quote.YearLow;
                            cloned.querySelector(".time").innerText = data.query.results.quote.LastTradeTime;

                            if (data.query.results.quote.Change < 0) {
                                cloned.querySelector('.price-change').classList.add('vp-neg');
                                cloned.querySelector('.price-percent').classList.add('vp-neg');
                            } else {
                                cloned.querySelector(".price-change").classList.add('vp-pos');
                                cloned.querySelector(".price-percent").classList.add('vp-pos');
                            }
                            self.querySelector('.stockquery-container').appendChild(cloned);

                            // setTimeout(getQuotes, 6000);
                        })
                    })

                }
                getQuotes();


                // function searchQuote() {
                //     var name = $('select').val();
                //     var url = "https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quotes%20where%20symbol%20in%20(%22" + name + "%22)&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=";
                //     var stocks = function (data) {
                //         $('select').change();
                //         $(".stock-name").html(data.query.results.quote.Symbol);
                //         $(".result").html("Live Price: $" + data.query.results.quote.LastTradePriceOnly);
                //         $(".result").hide().fadeIn(500);
                //         $(".time").html("Valid Time: " + data.query.results.quote.LastTradeTime);
                //         $(".change").html("Change: " + data.query.results.quote.Change);
                //         $(".percent").html("Percent: " + data.query.results.quote.ChangeinPercent);
                //         $(".year-low").html("Year Low: " + data.query.results.quote.YearLow);
                //         $(".year-high").html("Year High: " + data.query.results.quote.YearHigh);
                //         if (data.query.results.quote.Change < 0) {
                //             $(".change").css({
                //                 color: "red"
                //             })
                //             $(".percent").css({
                //                 color: "red"
                //             })
                //         } else if (data.query.results.quote.Change > 0) {
                //             $(".change").css({
                //                 color: "green"
                //             })
                //             $(".percent").css({
                //                 color: "green"
                //             })
                //         };
                //     };

                //     $.getJSON(url, stocks);
                //     setTimeout(searchQuote, 6000);
                // };
                // searchQuote();

                // function yahooQuote() {
                //     var stocks = function (data) {
                //         var text = "<ul>";
                //         text += "<h3>" + (data.query.results.quote.Name) + "</h3>";
                //         text += "<li class='live-price'>" + ("Live Price: $" + data.query.results.quote.LastTradePriceOnly) + "</li>";
                //         $(".live-price").hide().fadeIn(500);
                //         text += "<li>" + ("Valid Time: " + data.query.results.quote.LastTradeTime) + "</li>";
                //         text += "<li class='change'>" + ("Change: " + data.query.results.quote.Change) + "</li>";
                //         text += "<li class='percent'>" + ("Percent: " + data.query.results.quote.ChangeinPercent) + "</li>";
                //         text += "<li>" + ("Year Low: " + data.query.results.quote.YearLow) + "</li>";
                //         text += "<li>" + ("Year High: " + data.query.results.quote.YearHigh) + "</li>";
                //         text += "</ul>";
                //         if (data.query.results.quote.Change < 0) {
                //             $(".change").css({
                //                 color: "red"
                //             })
                //             $(".percent").css({
                //                 color: "red"
                //             })
                //         } else if (data.query.results.quote.Change > 0) {
                //             $(".change").css({
                //                 color: "green"
                //             })
                //             $(".percent").css({
                //                 color: "green"
                //             })
                //         };
                //         $('#yahoo').html(text);
                //     };
                //     $.getJSON(yahoo, stocks);

                //     setTimeout(yahooQuote, 6000);
                // }
                // yahooQuote();


            }

        })
    </script>
</j-dashlet>
<j-dashlet-editor id="stockquery-dashlet-editor">
    <template>
        <h3>this is editor for Stock Prices Dashlet</h3>
    </template>
</j-dashlet-editor>